"use strict";(self.webpackChunknfc_reserve=self.webpackChunknfc_reserve||[]).push([[9474],{9474:(y,_,a)=>{a.d(_,{w:()=>l});var r=a(2029),u=a(6223),C=a(7394),p=a(219),S=a(1206),f=a(5219),m=a(6814),O=a(4055),v=a(9515);const d=["conferenceSelector"];function b(o,g){1&o&&r._uU(0),2&o&&r.hij(" ",g.$implicit.name," ")}function e(o,g){1&o&&r._uU(0),2&o&&r.hij(" ",g.$implicit.name," ")}const t={id:-1,name:"\u2014 Nincs, vagy nincs enged\xe9lyezett konferenci\xe1ja \u2014",__none__:!0};let l=(()=>{class o{set preselectIds(s){const n=(Array.isArray(s)?s:null!=s?[s]:[]).map(h=>"string"==typeof h?Number(h):h).filter(h=>Number.isFinite(h));this._pendingSelectIds=n.length?n:void 0,this.preselectByIds()}runSilently(s){this.suppress++;try{return s()}finally{this.suppress--}}constructor(s,i,n,h){this.conferenceService=s,this.userService=i,this.messageService=n,this.cdr=h,this.selectFirstOption=!1,this.showClear=!0,this.showNoneOption=!0,this.style={},this.styleClass="",this.panelStyleClass="",this.disabledOptions=[],this.emitOnSelectFirstOption=!1,this.emitOnPreselectId=!1,this.emitOnWriteValue=!1,this.change=new r.vpe,this.loading=!0,this.disabled=!1,this.conferences=[],this.originalConferences=[],this.selectedConferences=[],this.isOrganizer=!1,this.currentUserId=null,this.subscriptions=new C.w0,this.suppress=0,this.isNone=c=>!!c?.__none__||-1===c?.id,this.getNone=()=>t,this.onChange=c=>{},this.onTouched=()=>{}}ngOnInit(){this.currentUserId=this.userService.getLoggedInUserId()||null;const s=this.userService.hasRole(["Szervezo"]).subscribe(i=>{this.isOrganizer=i,this.loadConferences()});this.subscriptions.add(s)}ngOnChanges(s){s.disabledOptions&&this.originalConferences.length>0&&this.updateDisabledFlags(),s.preselectIds&&this.preselectByIds()}ngOnDestroy(){this.subscriptions.unsubscribe()}loadConferences(){this.loading=!0;const s={sort:"beginDate",order:"asc",enabled:1};this.isOrganizer&&null!=this.currentUserId&&(s.organizer_user_id=this.currentUserId);const i=this.conferenceService.getSelector$(s).subscribe({next:n=>{const h=n??[],c=this.showNoneOption?[t,...h]:[...h];this.conferences=c,this.originalConferences=[...c],this.syncSelectedConferences(),this.handleSelectFirstOption(),this.updateDisabledFlags(),this.preselectByIds(),this.loading=!1,this.cdr.markForCheck()},error:()=>{this.conferences=[],this.originalConferences=[],this.loading=!1,this.messageService.add({severity:"error",summary:"Error",detail:"Failed to load conferences. Please try again later."}),this.cdr.markForCheck()}});this.subscriptions.add(i)}updateDisabledFlags(){const s=Array.isArray(this.disabledOptions)?this.disabledOptions:[];this.conferences=this.originalConferences.map(i=>({...i,disabled:!this.isNone(i)&&s.some(n=>n?.id===i.id)})),this.cdr.markForCheck()}setSelection(s,i){const n=i?.source??"programmatic";this.runSilently(()=>{this.selectedConferences=this.normalizeSelection(s)}),i?.emit?this.emit(this.selectedConferences,n,!0):this.cdr.markForCheck()}handleSelectFirstOption(){if(!this.selectFirstOption||this.selectedConferences.length||!this.conferences.length)return;const s=this.conferences.find(i=>!this.isNone(i)&&!i.disabled);s?(this.runSilently(()=>{this.selectedConferences=[s]}),this.emitOnSelectFirstOption?this.emit(this.selectedConferences,"auto-select-first",!0):this.cdr.markForCheck()):this.cdr.markForCheck()}preselectByIds(){if(!this.conferences?.length||!this._pendingSelectIds?.length)return;const s=new Set(this._pendingSelectIds),i=this.conferences.filter(n=>!this.isNone(n)&&s.has(Number(n.id)));this.runSilently(()=>{this.selectedConferences=i.slice(0,this.selectionLimit??i.length),this.conferenceSelectorRef?.writeValue(this.selectedConferences)}),this.emitOnPreselectId?this.emit(this.selectedConferences,"preselect-id",!0):this.cdr.markForCheck()}setDisabledState(s){this.disabled=s}syncSelectedConferences(){const s=Array.isArray(this.selectedConferences)?this.selectedConferences:[];this.selectedConferences=this.conferences.filter(i=>s.some(n=>n?.id===i?.id)),this.onChange(this.selectedConferences),this.cdr.markForCheck()}onSelectionChange(s){const i=Array.isArray(s?.value)?s.value:[];this.selectedConferences=this.normalizeSelection(i),this.emit(this.selectedConferences,"user"),1==this.selectionLimit&&this.selectedConferences?.length>=1&&setTimeout(()=>this.conferenceSelectorRef?.hide())}onSelectionClear(){this.runSilently(()=>{this.selectedConferences=[],this.conferenceSelectorRef?.writeValue([])}),this.emit(this.selectedConferences,"user",!0)}normalizeSelection(s){const i=Array.isArray(s)?s:[];return i.some(c=>this.isNone(c))?[this.getNone()]:i.slice(0,this.selectionLimit??i.length)}emit(s,i,n=!1){this.suppress&&!n||(this.onChange(s),this.onTouched(),this.change.emit({value:s,source:i}),this.cdr.markForCheck())}writeValue(s){const i=Array.isArray(s)?s:s?[s]:[];this.runSilently(()=>{this.selectedConferences=this.normalizeSelection(i)}),this.emitOnWriteValue?this.emit(this.selectedConferences,"programmatic",!0):this.cdr.markForCheck()}registerOnChange(s){this.onChange=s}registerOnTouched(s){this.onTouched=s}static#e=this.\u0275fac=function(i){return new(i||o)(r.Y36(p.Z),r.Y36(S.K),r.Y36(f.ez),r.Y36(r.sBO))};static#t=this.\u0275cmp=r.Xpm({type:o,selectors:[["app-conference-selector"]],viewQuery:function(i,n){if(1&i&&r.Gf(d,5),2&i){let h;r.iGM(h=r.CRH())&&(n.conferenceSelectorRef=h.first)}},inputs:{selectionLimit:"selectionLimit",selectFirstOption:"selectFirstOption",placeholder:"placeholder",showClear:"showClear",showNoneOption:"showNoneOption",style:"style",styleClass:"styleClass",panelStyle:"panelStyle",panelStyleClass:"panelStyleClass",disabledOptions:"disabledOptions",emitOnSelectFirstOption:"emitOnSelectFirstOption",emitOnPreselectId:"emitOnPreselectId",emitOnWriteValue:"emitOnWriteValue",preselectIds:"preselectIds"},outputs:{change:"change"},features:[r._Bn([{provide:u.JU,useExisting:(0,r.Gpc)(()=>o),multi:!0}]),r.TTD],decls:6,vars:16,consts:[[1,"w-full",3,"ngStyle","ngClass"],["dataKey","id","optionLabel","name","optionDisabled","disabled","scrollHeight","400px","appendTo","body","display","chip",1,"multiselect-custom-virtual-scroll",3,"options","ngModel","disabled","selectionLimit","placeholder","emptyMessage","virtualScroll","virtualScrollItemSize","showClear","resetFilterOnHide","ngModelChange","onChange","onClear"],["conferenceSelector",""],["pTemplate","item"],["pTemplate","selectedItem"]],template:function(i,n){1&i&&(r.TgZ(0,"div",0)(1,"p-multiSelect",1,2),r.NdJ("ngModelChange",function(c){return n.selectedConferences=c})("onChange",function(c){return n.onSelectionChange(c)})("onClear",function(){return n.onSelectionClear()}),r.ALo(3,"translate"),r.YNc(4,b,1,1,"ng-template",3),r.YNc(5,e,1,1,"ng-template",4),r.qZA()()),2&i&&(r.Q6J("ngStyle",n.style)("ngClass",n.styleClass),r.xp6(1),r.Akn(n.style),r.s9C("emptyMessage",r.lcZ(3,14,"Nincs tal\xe1lat...")),r.Q6J("options",n.conferences)("ngModel",n.selectedConferences)("disabled",n.disabled)("selectionLimit",n.selectionLimit)("placeholder",n.placeholder)("virtualScroll",!0)("virtualScrollItemSize",43)("showClear",n.showClear)("resetFilterOnHide",!0))},dependencies:[m.mk,m.PC,u.JJ,u.On,f.jx,O.NU,v.X$],encapsulation:2,changeDetection:0})}return o})()},219:(y,_,a)=>{a.d(_,{Z:()=>v});var r=a(5619),u=a(7398),C=a(6306),p=a(2096),S=a(940),f=a(9862),m=a(2029),O=a(8814);let v=(()=>{class d{constructor(e,t){this.apiService=e,this.http=t,this.apiURL=e.apiURL,this.data$=new r.X(null),this.message$=new r.X(null)}get conferenceObs(){return this.data$.asObservable()}get messageObs(){return this.message$.asObservable()}get(e,t,l,o){const g=localStorage.getItem("userrole"),s=localStorage.getItem("userid");if("Szervezo"===g&&s){const c=`organizer_user_id=${s}`;o=o?`${o}&${c}`:c}o.includes("enabled=")||(o=o?`${o}&enabled=1`:"enabled=1");let i="";""!==l&&(i=`sort=${l.sortField&&""!==l.sortField?l.sortField:"beginDate"}&order=${1===l.sortOrder?"ASC":"DESC"}`);const n=""!==i&&""!==o?i+"&"+o:""!==i&&""===o?i:""===i&&""!==o?o:"";this.apiService.get(`conference/get/${e}/${t}${""!==n?"?"+n:""}`).subscribe({next:c=>{this.data$.next(c)},error:c=>{this.message$.next(c)}})}getBySearch(e,t){let l="";""!==t&&(l=""!=t.sortField?`?sort=${t.sortField}&order=${1===t.sortOrder?"ASC":"DESC"}`:""),this.apiService.get(`conference/search/${e}${l}`).subscribe({next:o=>{this.data$.next(o)},error:o=>{this.message$.next(o)}})}getBySearchQuery(e){this.apiService.get(`conference/searchquery?${e}`).subscribe({next:t=>{this.data$.next(t)},error:t=>{this.message$.next(t)}})}create(e){this.apiService.post("conference/create/",e).subscribe({next:t=>{this.message$.next({severity:"success",summary:"Sikeres konferencia r\xf6gz\xedt\xe9s",detail:`${e.name} r\xf6gz\xedtve`})},error:t=>{this.message$.next(t)}})}update(e){this.apiService.put(`conference/update/${e.id}`,e).subscribe({next:()=>{this.message$.next({severity:"success",summary:"Sikeres konferencia m\xf3dos\xedt\xe1s",detail:`${e.name} m\xf3dos\xedtva`})},error:t=>{this.message$.next(t)}})}delete(e){this.apiService.delete(`conference/delete/${e.id}`).subscribe({next:t=>{this.message$.next({severity:"success",summary:"Sikeres konferencia t\xf6rl\xe9s",detail:`${e.name} t\xf6r\xf6lve`})},error:t=>{this.message$.next(t)}})}bulkdelete(e){let t={ids:e.map(l=>l.id)};this.apiService.post("conference/bulkdelete",t).subscribe({next:l=>{this.message$.next({severity:"success",summary:"Sikeres konferencia t\xf6rl\xe9s",detail:`${e.length} konferencia t\xf6r\xf6lve`})},error:l=>{this.message$.next(l)}})}getById(e){return this.apiService.get(`conference/getbyid/${e}`)}isSlugValid(e){return this.get(0,20,"slug=","sort"),this.data$.pipe((0,u.U)(t=>t&&t.data&&t.rows.length>0),(0,C.K)(()=>(0,p.of)(!1)))}assignRoomsToConference(e,t){return this.apiService.post(`conferencesroom/addroom/${e.id}`,{roomIds:t})}removeRoomsFromConference(e,t){return this.apiService.post(`conferencesroom/removeroom/${e}`,{roomIds:t})}saveFormFieldInfos(e){this.apiService.post(`conference/saveFormFieldInfos/${e.conferenceId}`,e.fields).subscribe({next:t=>{this.message$.next({severity:"success",summary:"Mez\u0151 inform\xe1ci\xf3k mentve",detail:"\u0170rlap mez\u0151 inform\xe1ci\xf3k sikeresen mentve"})},error:t=>{this.message$.next(t)}})}getSelector$(e={}){const l=this.buildSelectorParams(e).toString();return this.apiService.get("conference/selector"+(l?`?${l}`:"")).pipe((0,S.d)(1))}clearSelectorCache(){this.selectorCache$=void 0}buildSelectorParams(e){let t=new f.LE;if(void 0!==e.enabled){const l="boolean"==typeof e.enabled?e.enabled?"1":"0":String(e.enabled);t=t.set("enabled",l)}else t=t.set("enabled","1");return e.sort&&(t=t.set("sort",e.sort)),e.order&&(t=t.set("order",e.order)),e.date_from&&(t=t.set("date_from",e.date_from)),e.date_to&&(t=t.set("date_to",e.date_to)),null!=e.organizer_user_id&&(t=t.set("organizer_user_id",String(e.organizer_user_id))),t}getConferenceStatsByIds(e){if(!e||0===e.length)return(0,p.of)({});const l=(new f.LE).set("ids",e.join(",")).toString();return this.apiService.get(`conference/stats?${l}`)}getConferenceStat(e){return this.getConferenceStatsByIds([e]).pipe((0,u.U)(t=>t[e]??t[String(e)]??{guests:0,beds:0}))}static#e=this.\u0275fac=function(t){return new(t||d)(m.LFG(O.s),m.LFG(f.eN))};static#t=this.\u0275prov=m.Yz7({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()}}]);