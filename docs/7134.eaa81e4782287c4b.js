"use strict";(self.webpackChunknfc_reserve=self.webpackChunknfc_reserve||[]).push([[7134],{1200:(J,g,r)=>{r.r(g),r.d(g,{FoodCounterModule:()=>G});var u=r(6814),d=r(3979),h=r(5219),o=r(6676),e=r(9468),f=r(746),v=r(8645);let p=(()=>{class i{constructor(){this.mealChanged=new v.x,this.meals={breakfast:{begin:7,end:10},lunch:{begin:11,end:15},dinner:{begin:17,end:20}},this.checkMealStart(),setInterval(()=>{this.checkMealStart()},2e4)}checkMealStart(){const t=(new Date).getHours();for(const s of Object.keys(this.meals)){const a=this.meals[s];if(t>=a.begin&&t<a.end)return void this.mealChanged.next(s)}}getMealNameByTime(n){const t=n.getHours();for(const s in this.meals){const a=this.meals[s];if(t>=a.begin&&t<=a.end)return this.translateMealName(s)}return"Jelenleg nincs \xe9tkeztet\xe9s"}translateMealName(n){return{breakfast:"reggeli",lunch:"eb\xe9d",dinner:"vacsora"}[n]||n}isOpen(){const n=(new Date).getHours();for(const t in this.meals){const s=this.meals[t];if(n>=s.begin&&n<s.end)return!0}return!1}static#e=this.\u0275fac=function(t){return new(t||i)};static#t=this.\u0275prov=e.Yz7({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})();var b=r(3763),m=r(4104);function C(i,c){1&i&&(e.TgZ(0,"button",16)(1,"span",17),e._uU(2," \xc9tel kiadva "),e.qZA()())}function y(i,c){1&i&&(e.TgZ(0,"button",18)(1,"span",17),e._uU(2," Nincs el\u0151fizetve "),e.qZA()())}function M(i,c){1&i&&(e.TgZ(0,"button",18)(1,"span",17),e._uU(2," M\xe1r \xe1tvett \xe9tel "),e.qZA()())}function E(i,c){1&i&&(e.TgZ(0,"button",18)(1,"span",17),e._uU(2," Jelenleg nincs \xe9tkeztet\xe9s "),e.qZA()())}o.locale("hu");let w=(()=>{class i{constructor(n,t,s,a,l){this.router=n,this.guestService=t,this.mealService=s,this.logService=a,this.messageService=l,this.mealsNumber=0,this.loading=!1,this.alreadyRecievedFood=!1,this.canEat=!1,this.ageGroup="",this.scanTemp="",this.scannedCode="",this.backgroundColor="surface-ground",this.windowWidth=window.innerWidth||document.documentElement.clientWidth,this.windowHeight=window.innerHeight||document.documentElement.clientHeight}ngOnInit(){this.guestsObs$=this.guestService.guestObs,this.guestsObs$.subscribe(n=>{this.loading=!1,n&&(this.guests=n,this.setCurrentMealsNumber())}),this.mealService.mealChanged.subscribe(()=>{this.updateCurrentMeal()}),this.updateCurrentMeal(),this.resetGuest()}resetGuest(){this.ageGroup="",this.guest={lastName:"",firstName:"",diet:"",conferenceName:""}}keyEvent(n){if("Enter"===n.key)this.scannedCode=this.scanTemp,this.scanTemp="",console.log("scannedCode",this.scannedCode),this.logService.createLog({name:"FoodCounter scannedCode: "+this.scannedCode,capacity:0}),this.resetGuest(),this.getGuestByRFID(this.scannedCode);else if("\xf6"===n.key)this.scanTemp+="0";else{if(!/^[0-9]$/i.test(n.key))return;this.scanTemp+=n.key}}onResize(n){this.windowWidth=window.innerWidth||document.documentElement.clientWidth,this.windowHeight=window.innerHeight||document.documentElement.clientHeight}updateCurrentMeal(){this.isOpen=this.mealService.isOpen();let n=this.mealService.getMealNameByTime(new Date);n!==this.currentMeal&&(this.currentMeal=n,this.mealsNumber=0)}getGuestByRFID(n){this.guestService.getByRFID(n).subscribe({next:t=>{this.guest=t,this.setAgeGroup(this.guest.birthDate);let s=o(),a=o(new Date(t.dateOfArrival).setHours(0)),l=o(new Date(t.dateOfDeparture).setHours(24));if(a<=s&&s<=l&&(a.isSame(s,"day")&&("reggeli"==this.currentMeal?"reggeli"==t.firstMeal&&(this.canEat=!0):"eb\xe9d"==this.currentMeal?("reggeli"==t.firstMeal||"eb\xe9d"==t.firstMeal)&&(this.canEat=!0):"vacsora"==this.currentMeal&&("reggeli"==t.firstMeal||"eb\xe9d"==t.firstMeal||"vacsora"==t.firstMeal)&&(this.canEat=!0)),a!==s&&s!==l&&(this.canEat=!0),l.isSame(s,"day")&&("reggeli"==this.currentMeal&&("reggeli"==t.lastMeal||"eb\xe9d"==t.lastMeal||"vacsora"==t.lastMeal)&&(this.canEat=!0),"eb\xe9d"==this.currentMeal?("eb\xe9d"==t.lastMeal||"vacsora"==t.lastMeal)&&(this.canEat=!0):"vacsora"==this.currentMeal&&"vacsora"==t.lastMeal&&(this.canEat=!0))),this.alreadyRecievedFood=!1,t.lastRfidUsage){let k=new Date(t.lastRfidUsage),I=this.mealService.getMealNameByTime(k);this.currentMeal==I&&(this.alreadyRecievedFood=!0,this.logService.createLog({name:"FoodCounter Already received food: "+this.guest.lastName+" "+this.guest.firstName+" "+this.scannedCode,capacity:0}))}this.mealsNumber++,this.guest.lastRfidUsage=o().format("YYYY-MM-DD HH:mm:ss"),this.guestService.updateGuest(this.guest),this.backgroundColor=this.getDietColor(this.guest.diet)},error:t=>{console.error("Error:",t),404===t.status&&(this.guest={lastName:"ISMERETLEN",firstName:"ESZK\xd6Z"},this.logService.createLog({name:"FoodCounter Unknown Device: "+this.scannedCode,capacity:0}))}})}setAgeGroup(n){if(n){let t=o(new Date(n)),a=o.duration(o(new Date).diff(t)).asYears();this.ageGroup=a>=10?"feln\u0151tt":"gyermek"}else this.ageGroup="Hib\xe1s d\xe1tum"}setCurrentMealsNumber(){this.guests.map(n=>{if("G\xe1bris"!==n.lastName&&n.lastRfidUsage){let t=o(new Date(n.lastRfidUsage)),s=o();if(t.isSame(s,"day")){let a=this.mealService.getMealNameByTime(new Date(n.lastRfidUsage));this.currentMeal==a&&this.mealsNumber++}}})}getDietColor(n){switch(this.guest.diet){case"tejmentes":case"lakt\xf3zmentes":return"blue-400";case"glut\xe9nmentes":return"yellow-300";case"glut\xe9n-, lakt\xf3z-, tejmentes":return"red-500";case"veget\xe1ri\xe1nus":return"teal-500";case"nem k\xe9r \xe9tkez\xe9st":return"gray-300";default:return"gray-700"}}ngOnDestroy(){}static#e=this.\u0275fac=function(t){return new(t||i)(e.Y36(d.F0),e.Y36(f.Q),e.Y36(p),e.Y36(b.$),e.Y36(h.ez))};static#t=this.\u0275cmp=e.Xpm({type:i,selectors:[["food-counter"]],hostBindings:function(t,s){1&t&&e.NdJ("keypress",function(l){return s.keyEvent(l)},!1,e.Jf7)("resize",function(l){return s.onResize(l)},!1,e.Jf7)},features:[e._Bn([h.ez])],decls:59,vars:16,consts:[[1,"relative","overflow-hidden","flex","flex-column","justify-content-center"],[1,"header",3,"ngClass"],[1,"p-1","font-medium","text-center","text-2xl","text-white","white-space-nowrap"],[1,"absolute","top-0","right-0","p-2","text-white","text-sm"],[1,"px-4","py-4",3,"ngClass"],[1,"grid"],[1,"col-12","md:col-12","lg:col-6","p-2"],[1,"info-box","surface-card","shadow-2","p-3","border-round","border-teal-500"],[1,"flex","justify-content-between"],[1,"block","text-500","text-xl","font-medium","mb-3"],[1,"text-900","font-medium","text-2xl"],[1,"grid","mt-1"],[1,"surface-card","shadow-2","border-round"],[1,"flex","align-items-center","justify-content-center","gap-2"],["class","flex align-items-center justify-content-center w-full h-fullgap-2 bg-teal-500 shadow-1 border-round-sm border-none cursor-pointer hover:bg-teal-600 transition-duration-200","style","min-height: 80px;",4,"ngIf"],["class","flex align-items-center justify-content-center w-full h-fullgap-2 bg-red-500 shadow-1 border-round-sm border-none cursor-pointer hover:bg-red-600 transition-duration-200","style","min-height: 80px;",4,"ngIf"],[1,"flex","align-items-center","justify-content-center","w-full","h-fullgap-2","bg-teal-500","shadow-1","border-round-sm","border-none","cursor-pointer","hover:bg-teal-600","transition-duration-200",2,"min-height","80px"],[1,"font-medium","text-2xl","text-white","white-space-nowrap"],[1,"flex","align-items-center","justify-content-center","w-full","h-fullgap-2","bg-red-500","shadow-1","border-round-sm","border-none","cursor-pointer","hover:bg-red-600","transition-duration-200",2,"min-height","80px"]],template:function(t,s){1&t&&(e.TgZ(0,"div",0)(1,"div",1)(2,"div",2),e._uU(3),e.ALo(4,"titlecase"),e.qZA(),e.TgZ(5,"div",3),e._uU(6),e.qZA()(),e.TgZ(7,"div",4)(8,"div",5)(9,"div",6)(10,"div",7)(11,"div",8)(12,"div")(13,"span",9),e._uU(14,"Vend\xe9g"),e.qZA(),e.TgZ(15,"div",10),e._uU(16),e.qZA()()()()(),e.TgZ(17,"div",6)(18,"div",7)(19,"div",8)(20,"div")(21,"span",9),e._uU(22,"\xc9trend"),e.qZA(),e.TgZ(23,"div",10),e._uU(24),e.qZA()()()()()(),e.TgZ(25,"div",11)(26,"div",6)(27,"div",7)(28,"div",8)(29,"div")(30,"span",9),e._uU(31,"Koroszt\xe1ly"),e.qZA(),e.TgZ(32,"div",10),e._uU(33),e.qZA()()()()(),e.TgZ(34,"div",6)(35,"div",7)(36,"div",8)(37,"div")(38,"span",9),e._uU(39,"Konferencia"),e.qZA(),e.TgZ(40,"div",10),e._uU(41),e.qZA()()()()()(),e.TgZ(42,"div",11)(43,"div",6)(44,"div",7)(45,"div",8)(46,"div")(47,"span",9),e._uU(48,"M\xe1r kiadott \xe9telek sz\xe1ma"),e.qZA(),e.TgZ(49,"div",10),e._uU(50),e.qZA()()()()(),e.TgZ(51,"div",6)(52,"div",12)(53,"div",13),e.YNc(54,C,3,0,"button",14),e.YNc(55,y,3,0,"button",15),e.YNc(56,M,3,0,"button",15),e.YNc(57,E,3,0,"button",15),e.qZA()()()()()(),e._UZ(58,"p-toast")),2&t&&(e.xp6(1),e.Q6J("ngClass",s.isOpen?"bg-teal-500":"bg-red-500"),e.xp6(2),e.hij(" ",s.isOpen?e.lcZ(4,14,s.currentMeal):"Jelenleg nincs \xe9tkeztet\xe9s!"," "),e.xp6(3),e.hij(" ",s.scannedCode," "),e.xp6(1),e.Q6J("ngClass","bg-"+s.backgroundColor),e.xp6(9),e.AsE(" ",s.guest.lastName," ",s.guest.firstName,"\xa0 "),e.xp6(8),e.hij("",s.guest.diet,"\xa0"),e.xp6(9),e.hij("",s.ageGroup,"\xa0"),e.xp6(8),e.hij("",s.guest.conferenceName,"\xa0"),e.xp6(9),e.Oqu(s.mealsNumber),e.xp6(4),e.Q6J("ngIf",s.isOpen&&s.canEat&&!s.alreadyRecievedFood),e.xp6(1),e.Q6J("ngIf",s.isOpen&&!s.canEat),e.xp6(1),e.Q6J("ngIf",s.isOpen&&s.canEat&&s.alreadyRecievedFood),e.xp6(1),e.Q6J("ngIf",!s.isOpen))},dependencies:[u.mk,u.O5,m.FN,u.rS]})}return i})();var N=r(9502);let T=(()=>{class i{static#e=this.\u0275fac=function(t){return new(t||i)};static#t=this.\u0275mod=e.oAB({type:i});static#s=this.\u0275inj=e.cJS({imports:[d.Bz.forChild([{path:"",component:w}]),N.$,d.Bz]})}return i})();var A=r(707),x=r(1913),F=r(1567),S=r(95),U=r(3714),D=r(8057),O=r(6760),z=r(3965),H=r(4532),R=r(3722),j=r(1865),B=r(3259);let G=(()=>{class i{static#e=this.\u0275fac=function(t){return new(t||i)};static#t=this.\u0275mod=e.oAB({type:i});static#s=this.\u0275inj=e.cJS({imports:[u.ez,T,S.UX,U.j,D.nD,O._8,z.kW,H.d,R.O,A.hJ,j.cc,d.Bz,x.l,F.h,m.EV,B.z]})}return i})()}}]);